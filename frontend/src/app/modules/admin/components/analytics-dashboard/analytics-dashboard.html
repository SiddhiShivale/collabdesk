<div class="analytics-dashboard">
  <h2>System Analytics Dashboard</h2>

  <div *ngIf="analytics$ | async as data">
    
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-value">{{ data.totalTasks }}</div>
        <div class="kpi-label">Total Tasks</div>
      </div>

      <div class="kpi-card status-done-bg">
        <div class="kpi-value">{{ data.completionRate }}%</div>
        <div class="kpi-label">Completion Rate</div>
      </div>

      <div class="kpi-card status-blocked-bg">
        <div class="kpi-value">{{ data.overdueTasks }}</div>
        <div class="kpi-label">Overdue Tasks</div>
      </div>
      
      <div class="kpi-card">
        <div class="kpi-value">{{ data.totalUsers }}</div>
        <div class="kpi-label">Total Users</div>
      </div>
    </div>
    
    <div class="charts-grid">
      
      <div class="panel">
        <h3>Task Status Distribution</h3>
        <p class="text-xs text-gray-500">Percentage distribution of all tasks by status.</p>

        <div class="pie-chart-container">
          <div *ngIf="tasksByStatus$ | async as statusData">
            
            <div *ngIf="statusData.length === 0" class="text-center text-gray-400 py-4">No tasks to analyze.</div>
            
            <div class="pie-chart-wrapper">
              <div 
                class="pie-chart" 
                [style.background]="getPieChartStyle(statusData)"
              >
                <div class="pie-center">Total: {{ data.totalTasks }}</div>
              </div>
            </div>

            <ul class="pie-legend">
              <li *ngFor="let item of statusData" [ngClass]="item.class">
                <span class="legend-dot"></span>
                {{ item.status | titlecase }} ({{ item.percentage }}%)
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="panel">
        <h3>Active Tasks by Team</h3>
        <p class="text-xs text-gray-500">Total tasks (excluding DONE) per team, relative to the busiest team.</p>
        
        <div class="chart-container">
          <div *ngIf="tasksByTeamChartData$ | async as teamData">
            <div *ngIf="teamData.length === 0" class="text-center text-gray-400 py-4">No active tasks to analyze.</div>
            <div *ngFor="let item of teamData" class="chart-bar-row">
              <span class="chart-label chart-team">{{ item.teamName }} ({{ item.count }})</span>
              <div class="chart-bar-wrapper">
                <div 
                  class="chart-bar chart-team-bar" 
                  [style.width.%]="item.percentage"
                  [attr.data-count]="item.count"
                >
                </div>
                <span class="chart-percentage">{{ item.percentage }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>